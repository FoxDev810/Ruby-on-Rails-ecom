<script type="text/javascript">
  var brokenContentSize = $("#content").prop("offsetWidth") == 0;

  function resizeContent() {
    var content = $("#content");
    var leftMargin = parseInt(content.css("left"));
    var rightMargin = parseInt(content.css("right"));
    var bottomMargin = parseInt(content.css("bottom"));

    <% if t('html.dir') == "ltr" -%>
    content.width($(window).width() - content.prop("offsetLeft") - rightMargin);
    <% else -%>
    content.width($(window).width() - content.prop("offsetRight") - leftMargin);
    <% end -%>
    content.height($(window).height() - content.prop("offsetTop") - bottomMargin);
  }

  function resizeMap() {
    var sidebar_width = 0 + $("#sidebar:visible").width();

    if (sidebar_width > 0) {
      sidebar_width = sidebar_width + 5
    }

    <% if t('html.dir') == "ltr" -%>
    $("#map").css("left", (sidebar_width) + "px");
    <% else -%>
    $("#map").css("right", (sidebar_width) + "px");
    <% end -%>
    $("#map").width($("#content").width() - sidebar_width);
    $("#map").height($("#content").height() - 2);
  }

  function handleResize() {
    if (brokenContentSize) {
      resizeContent();
    }

    resizeMap();
  }
</script>
