<header>
  <h1>
    <a href="<% root_path %>" class="geolink llz layers">
      <%= image_tag "osm_logo.png", :alt => t('layouts.logo.alt_text'), :class => 'logo' %>
      <%= t 'layouts.project_name.h1' %>
    </a>
  </h1>
  <nav class='primary'>
    <ul>
      <li id="view_tab">
        <%= link_to t('layouts.view'), root_path, :class => 'tab geolink llz layers' %>
      </li><li id="edit_tab" class="dropdown">
      <%= link_to t('layouts.edit'), edit_path, :class => "tab geolink llz object",
                  :id => 'editanchor',
                  :data => { :editor => preferred_editor }
      %><a class='dropdown-toggle' data-toggle='dropdown' href='#'><b class="caret"></b></a>
      <ul class='dropdown-menu'>
        <% Editors::RECOMMENDED_EDITORS.each do |editor| %>
          <li>
            <%= link_to t('layouts.edit_with', :editor => t("editor.#{editor}.description")),
                        edit_path(:editor => editor),
                        :data => { :editor => editor },
                        :class => "geolink llz object" %>
          </li>
        <% end %>
      </ul>
      </li><li id="history_tab">
        <%= link_to t('layouts.history'), browse_changesets_path, :class => 'tab geolink llz' %>
      </li><li id="export_tab">
        <%= link_to t('layouts.export'), export_path, :class => 'tab geolink llz' %>
      </li>
    </ul>
  </nav>
  <nav class='secondary'>
    <ul>
      <li><%= link_to t('layouts.gps_traces'), traces_path %></li>
      <li><%= link_to t('layouts.user_diaries'), diary_path %></li>
      <li><%= link_to t('layouts.help'), help_path %></li>
      <li><%= link_to t('layouts.about'), about_path %></li>
    </ul>
    <% if @user %>
      <div class='dropdown user-menu'>
        <a class='dropdown-toggle' data-toggle='dropdown' href="#">
          <%= user_thumbnail_tiny(@user, :size => 20, :width => 20, :height => 20)
          %><%= render :partial => 'layouts/inbox'
        %><span class='username'><%= @user.display_name %></span>
          <b class="caret"></b>
        </a>
        <ul class='dropdown-menu'>
          <li>
            <%= link_to inbox_path(:display_name => @user.display_name) do %>
              <span class='count-number'><%= number_with_delimiter(@user.new_messages.size) %></span>
              <%= t('message.inbox.my_inbox') %>
            <% end %>
          </li>
          <li>
            <%= link_to t('user.view.my profile'), user_path(:display_name => @user.display_name) %>
          </li>
          <li>
            <%= link_to t('user.view.my settings'), :controller => 'user', :action => 'account', :display_name => @user.display_name %>
          </li>
          <li class="divider"></li>
          <li>
            <%= yield :greeting %>
          </li>
          <li>
            <%= link_to t('layouts.logout'), logout_path(:session => request.session_options[:id], :referer => request.fullpath) %>
          </li>
        </ul>
      </div>
    <% else %>
      <ul class="user-menu">
        <li><%= link_to t('layouts.log_in'), login_path(:referer => request.fullpath) %></li>
        <li><%= link_to t('layouts.sign_up'), user_new_path %></li>
      </ul>
    <% end %>
  </nav>
</header>
